# 本書について

本書は、私が RDSR について調べたことを、私の視点でまとめたものです。
主に、RDSRのDICOMフォーマットでの保存形式について調べたため、対象は
RDSRというよりも、SR(Structured Report)についての調査結果のほうが
近いかもしれません。

ただし、あくまでもターゲットはRDSRなので、RDSRでは現れない形式についての
調査はほぼ全く行っていいません。

# 対象読者

対象読者は、以下を想定しています。

1. DICOM の基本的な知識はある人。
   PS3.3のIODや、PS3.5のDICOMフォーマットについての基礎的な知識は前提としています。
2. 規格書を呼んでもRDSRの記載から、どのようにDICOMのフォーマットに展開されるのかがイメージできない人。
   結局は、規格書に書いてあることを私の言葉で解説しているだけです。

# DICOM SRの構造の概要

ターゲットはRDSRですが、フォーマットについての話なので、最初はDICOM SR全般の話から入ります。

DICOM SRを説明する場合、タグの構造の話と、テンプレートの話があります。

個人的な感触ですが、世の中の解説書はテンプレートについての説明が大半で、
タグ構造について説明されているものはほとんど見たことがありません。

*タグ構造* : データのバイナリストリームにどうやって表現するかの規則。     
*テンプレート構造* : どのようなデータをどのような構造で保持・管理するかについて、概念的な構造の規則。

これ以降、しばらくはDICOM SRのタグ構造について述べていきます。

# DICOM SRのタグ構造

## 対応するDICOM規格

PS3.3 A35.8(X-Ray Radiation Dose SR IOD)から始まって、C17.3 (SR Document Content) とたどります。

この、 C17.3 (SR Document Content) がRDSRのテンプレート構造をいかにDICOMのタグ構造で表すかを説明している部分です。

ただ、C17.3だけ見ても何のことだかさっぱりとなると思います。

この規格書の記載だで十分理解できた人は、これ以上私の解説を読む必要はありません。

ちなみに、ここまで読んだ時の私の疑問は以下のようなものでした。

- よく、SRの構造ってXMLと似ているって言われているけど、これのどこがXMLなんだ?
- XMLのタグやテキストとこのタグ構造って、一体どう対応するんだ?

## タグ表現

XMLとDICOM SRの構造の対応は、トップダウンよりもボトムアップのほうが理解しやすいと思います。

ですから、最初は比較的小さい塊を考えることにします。例として、1回のばく射実績を表す組(撮影管電圧(KVP)=80kV, 管電流(mA)=200mA, 撮影時間(ms)=5ms)を表現したいとします。

XMLで表現するとなると、例えば、以下のような表現が考えられます。

    <RadXRayResult>
        <KVP>80</KVP>
        <mA>200</mA>
        <ms>5<ms>
    </RadXRayResut>

これをDICOM SRの構造に変換するために、以下のように置き換えていく。

KVP, mA, ms のノードは、すべて type="NUM" の属性を持つ、node というノードで表す。

    <RADXrayResult>
        <node type="NUM">
            <key>KVP</key>
            <number unit="kV">80</number>
        </node>
        <node  type="NUM">
            <key>mA</key>
            <number unit="mA">200</number>
        </node>
    </RADXRayResult>

